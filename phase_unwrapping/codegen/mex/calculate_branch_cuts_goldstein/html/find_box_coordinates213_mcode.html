<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S52T27U489">BOX_ROWS</span>, <span class="var type1" id="S53T27U490">BOX_COLS</span>] = find_box_coordinates(<span class="var type1" id="S54T30U493">PIXEL_LOC</span>, <span class="var type1" id="S55T30U494">DIMS</span>, <span class="var type1" id="S56T2U495">BOX_SIZE</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line"><span class="comment">% This function calculates the extents of a square odd-sized search box.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line"><span class="comment">% Radius of the box. Round to enforce odd-sized boxes.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line"><span class="mxinfo " id="T2:U6"><span class="var type1" id="S57T2U498">box_radius</span> = <span class="mxinfo " id="T2:U8">round(<span class="mxinfo " id="T2:U9">(<span class="mxinfo " id="T2:U10"><span class="var type1" id="S56T2U504">BOX_SIZE</span> - <span class="mxinfo " id="T2:U12">1</span></span>) / <span class="mxinfo " id="T2:U13">2</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line"><span class="comment">% Set the top-most row of the box to the </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line"><span class="comment">% anchor pixel row position minus the box radius.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line"><span class="comment">% If this results in a negative position, then set the</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line"><span class="comment">% top edge of the box equal to the top edge of the image.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line"><span class="mxinfo " id="T2:U14"><span class="var type1" id="S59T2U509">box_rows_min</span> = <span class="mxinfo " id="T2:U16">max(<span class="mxinfo " id="T2:U17">1</span>, <span class="mxinfo " id="T2:U18"><span class="mxinfo " id="T2:U19"><span class="var type1" id="S54T30U515">PIXEL_LOC</span>(<span class="mxinfo " id="T2:U21">1</span>)</span> - <span class="var type1" id="S57T2U517">box_radius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line"><span class="comment">% Set the bottom-most row of the box to the </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line"><span class="comment">% anchor pixel row position plus the box radius.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line"><span class="comment">% If this results in a position greater than the number of rows</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line"><span class="comment">% in the image, then set the bottom edge of the box equal</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line"><span class="comment">% to the bottom edge of the image.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line"><span class="mxinfo " id="T2:U23"><span class="var type1" id="S61T2U520">box_rows_max</span> = <span class="mxinfo " id="T2:U25">min(<span class="mxinfo " id="T2:U26"><span class="var type1" id="S55T30U524">DIMS</span>(<span class="mxinfo " id="T2:U28">1</span>)</span>, <span class="mxinfo " id="T2:U29"><span class="mxinfo " id="T2:U30"><span class="var type1" id="S54T30U528">PIXEL_LOC</span>(<span class="mxinfo " id="T2:U32">1</span>)</span> + <span class="var type1" id="S57T2U530">box_radius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line"><span class="comment">% Set the left-most column of the box to the </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line"><span class="comment">% anchor pixel column position minus the box radius.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line"><span class="comment">% If this results in a negative position, then set the left-edge</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"><span class="comment">% of the box equal to the left edge of the image.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"><span class="mxinfo " id="T2:U34"><span class="var type1" id="S63T2U533">box_cols_min</span> = <span class="mxinfo " id="T2:U36">max(<span class="mxinfo " id="T2:U37">1</span>, <span class="mxinfo " id="T2:U38"><span class="mxinfo " id="T2:U39"><span class="var type1" id="S54T30U539">PIXEL_LOC</span>(<span class="mxinfo " id="T2:U41">2</span>)</span> - <span class="var type1" id="S57T2U541">box_radius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line"><span class="comment">% Set the right-most column of the box to the </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,264" id="srcline264">264</a></span><span class="line"><span class="comment">% anchor pixel column position plus the box radius.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,265" id="srcline265">265</a></span><span class="line"><span class="comment">% If this results in a position greater than the number of columns</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,266" id="srcline266">266</a></span><span class="line"><span class="comment">% in the image, then set the right edge of the box equal</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,267" id="srcline267">267</a></span><span class="line"><span class="comment">% to the right edge of the image.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,268" id="srcline268">268</a></span><span class="line"><span class="mxinfo " id="T2:U43"><span class="var type1" id="S64T2U544">box_cols_max</span> = <span class="mxinfo " id="T2:U45">min(<span class="mxinfo " id="T2:U46"><span class="var type1" id="S55T30U548">DIMS</span>(<span class="mxinfo " id="T2:U48">2</span>)</span>, <span class="mxinfo " id="T2:U49"><span class="mxinfo " id="T2:U50"><span class="var type1" id="S54T30U552">PIXEL_LOC</span>(<span class="mxinfo " id="T2:U52">2</span>)</span> + <span class="var type1" id="S57T2U554">box_radius</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,269" id="srcline269">269</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,270" id="srcline270">270</a></span><span class="line"><span class="comment">% Create matrices of the box pixel positions </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,271" id="srcline271">271</a></span><span class="line">[<span class="mxinfo " id="T37:U54"><span class="var type1" id="S53T37U558">BOX_COLS</span></span>, <span class="mxinfo " id="T37:U56"><span class="var type1" id="S52T37U559">BOX_ROWS</span></span>] = meshgrid(<span class="mxinfo " id="T34:U58"><span class="var type1" id="S63T2U563">box_cols_min</span> : <span class="var type1" id="S64T2U564">box_cols_max</span></span>,<span class="keyword">...</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,272" id="srcline272">272</a></span><span class="line">    <span class="mxinfo " id="T34:U61"><span class="var type1" id="S59T2U566">box_rows_min</span> : <span class="var type1" id="S61T2U567">box_rows_max</span></span>);</span></span>
<span class="srcline"><span class="lineno"><a href="1,273" id="srcline273">273</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,274" id="srcline274">274</a></span><span class="line"><span class="comment">% Turn the arrays into vectors</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,275" id="srcline275">275</a></span><span class="line"><span class="mxinfo " id="T27:U64"><span class="var type1" id="S53T27U570">BOX_COLS</span> = <span class="mxinfo " id="T27:U66"><span class="var type1" id="S53T37U572">BOX_COLS</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,276" id="srcline276">276</a></span><span class="line"><span class="mxinfo " id="T27:U68"><span class="var type1" id="S52T27U576">BOX_ROWS</span> = <span class="mxinfo " id="T27:U70"><span class="var type1" id="S52T37U578">BOX_ROWS</span>(:)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,277" id="srcline277">277</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,278" id="srcline278">278</a></span><span class="line"><span class="comment">% Index of the anchor pixel in the box rows / columns arrays</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,279" id="srcline279">279</a></span><span class="line"><span class="mxinfo " id="T27:U72"><span class="var type1" id="S66T27U582">anchor_pix_index</span> = <span class="mxinfo " id="T27:U74">find(<span class="mxinfo " id="T26:U75"><span class="mxinfo " id="T26:U76"><span class="var type1" id="S53T27U587">BOX_COLS</span> == <span class="mxinfo " id="T2:U78"><span class="var type1" id="S54T30U589">PIXEL_LOC</span>(<span class="mxinfo " id="T2:U80">2</span>)</span></span> &amp; <span class="mxinfo " id="T26:U81"><span class="var type1" id="S52T27U592">BOX_ROWS</span> == <span class="mxinfo " id="T2:U83"><span class="var type1" id="S54T30U594">PIXEL_LOC</span>(<span class="mxinfo " id="T2:U85">1</span>)</span></span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,280" id="srcline280">280</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,281" id="srcline281">281</a></span><span class="line"><span class="comment">% Don't include the anchor pixel in the box coordinates. </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,282" id="srcline282">282</a></span><span class="line"><span class="mxinfo " id="T27:U86"><span class="var type1" id="S53T27U599">BOX_COLS</span>(<span class="var type1" id="S66T27U600">anchor_pix_index</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,283" id="srcline283">283</a></span><span class="line"><span class="mxinfo " id="T27:U89"><span class="var type1" id="S52T27U606">BOX_ROWS</span>(<span class="var type1" id="S66T27U607">anchor_pix_index</span>) = []</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,284" id="srcline284">284</a></span><span class="line">        </span></span>
<span class="srcline"><span class="lineno"><a href="1,285" id="srcline285">285</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,286" id="srcline286">286</a></span><span class="line"></span></span>
</pre>

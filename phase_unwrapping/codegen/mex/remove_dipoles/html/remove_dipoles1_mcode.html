<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T1U3">FLAGS_MATRIX</span> = remove_dipoles(<span class="mxinfo " id="T1:U2"><span class="mxinfo " id="T1:U3"><span class="var type1" id="S2T1U6">FLAGS_MATRIX</span></span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% Define values for the different flags<span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Note that matlab indexes bit positions the same way</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">% it does arrays, e.g., little-endian bit 1 corresponds to 2^0.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% Positive residue flag bit-position and byte-value-if-true</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="mxinfo " id="T2:U5"><span class="var type1" id="S3T2U9">positive_residue_bit_position</span> = <span class="mxinfo " id="T2:U7">1</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">% Negative residue flag bit position and byte-value-if-true</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="mxinfo " id="T2:U8"><span class="var type1" id="S4T2U13">negative_residue_bit_position</span> = <span class="mxinfo " id="T2:U10">2</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">% Branch cut flag bit position and byte-value-if-true</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="mxinfo " id="T2:U11"><span class="var type1" id="S5T2U17">branch_cut_bit_position</span> = <span class="mxinfo " id="T2:U13">3</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% Determine the locations of the residues</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="mxinfo " id="T27:U14"><span class="var type1" id="S6T27U21">residue_locs</span> = <span class="mxinfo " id="T27:U16"><span class="fcn" id="F53N3:B23">find_residue_locs</span>(<span class="var type1" id="S2T1U24">FLAGS_MATRIX</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">% Number of residues identified</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="mxinfo " id="T2:U18"><span class="var type1" id="S8T2U27">num_residues</span> = <span class="mxinfo " id="T2:U20">length(<span class="var type1" id="S6T27U30">residue_locs</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">% Flags matrix dimensions</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="mxinfo " id="T2:U22">[<span class="var type1" id="S10T2U34">height</span>, <span class="var type1" id="S11T2U35">width</span>] = size(<span class="var type1" id="S2T1U38">FLAGS_MATRIX</span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% Loop over all the residues</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S13T2U41">k</span> = <span class="mxinfo " id="T2:U27">1</span> : <span class="var type1" id="S8T2U44">num_residues</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line">   </span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line">    <span class="comment">% Residue row and column</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line">    <span class="mxinfo " id="T2:U29"><span class="var type1" id="S14T2U47">anchor_row</span> = <span class="mxinfo " id="T2:U31"><span class="mxinfo " id="T2:U32">rem(<span class="mxinfo " id="T2:U33"><span class="mxinfo " id="T2:U34"><span class="var type1" id="S6T27U53">residue_locs</span>(<span class="var type1" id="S13T2U54">k</span>)</span> - <span class="mxinfo " id="T2:U37">1</span></span>, <span class="var type1" id="S10T2U56">height</span>)</span> + <span class="mxinfo " id="T2:U39">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line">    <span class="mxinfo " id="T2:U40"><span class="var type1" id="S16T2U60">anchor_col</span> = <span class="mxinfo " id="T2:U42"><span class="mxinfo " id="T2:U43">(<span class="mxinfo " id="T2:U44"><span class="mxinfo " id="T2:U45"><span class="var type1" id="S6T27U66">residue_locs</span>(<span class="var type1" id="S13T2U67">k</span>)</span> - <span class="var type1" id="S14T2U68">anchor_row</span></span>) / <span class="var type1" id="S10T2U69">height</span></span> + <span class="mxinfo " id="T2:U50">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line">    <span class="comment">% Anchor flag</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line">   <span class="mxinfo " id="T9:U51"><span class="var type1" id="S17T9U73">anchor_flag</span> = <span class="mxinfo " id="T9:U53"><span class="var type1" id="S2T1U75">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U76">anchor_row</span>, <span class="var type1" id="S16T2U77">anchor_col</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line">    </span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line">   <span class="comment">% Check if the pixel is still marked as a residue,</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line">   <span class="comment">% since its residue flag may have been removed.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line">   <span class="keyword">if</span> <span class="mxinfo " id="T3:U57"><span class="fcn" id="F80N6:B81">is_residue</span>(<span class="var type1" id="S17T9U82">anchor_flag</span>)</span> </span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line">       <span class="mxinfo " id="T2:U59"><span class="var type1" id="S19T2U85">anchor_charge</span> = <span class="mxinfo " id="T2:U61"><span class="fcn" id="F81N4:B87">get_flags_charge</span>(<span class="var type1" id="S17T9U88">anchor_flag</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line">       <span class="comment">% Determine the rows and columns of the surrounding pixels.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line">       <span class="mxinfo " id="T28:U63"><span class="var type1" id="S21T28U91">rows</span> = <span class="mxinfo " id="T28:U65"><span class="var type1" id="S14T2U93">anchor_row</span> + <span class="mxinfo " id="T28:U67">[<span class="mxinfo " id="T2:U68">-<span class="mxinfo " id="T2:U69">1</span></span>, <span class="mxinfo " id="T2:U70">0</span>, <span class="mxinfo " id="T2:U71">1</span>, <span class="mxinfo " id="T2:U72">-<span class="mxinfo " id="T2:U73">1</span></span>, <span class="mxinfo " id="T2:U74">1</span>, <span class="mxinfo " id="T2:U75">-<span class="mxinfo " id="T2:U76">1</span></span>, <span class="mxinfo " id="T2:U77">0</span>, <span class="mxinfo " id="T2:U78">1</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line">       <span class="mxinfo " id="T28:U79"><span class="var type1" id="S22T28U109">cols</span> = <span class="mxinfo " id="T28:U81"><span class="var type1" id="S16T2U111">anchor_col</span> + <span class="mxinfo " id="T28:U83">[<span class="mxinfo " id="T2:U84">-<span class="mxinfo " id="T2:U85">1</span></span>, <span class="mxinfo " id="T2:U86">-<span class="mxinfo " id="T2:U87">1</span></span>, <span class="mxinfo " id="T2:U88">-<span class="mxinfo " id="T2:U89">1</span></span>, <span class="mxinfo " id="T2:U90">0</span>, <span class="mxinfo " id="T2:U91">0</span>, <span class="mxinfo " id="T2:U92">1</span>, <span class="mxinfo " id="T2:U93">1</span>, <span class="mxinfo " id="T2:U94">1</span>]</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line">       <span class="comment">% Number of surrounding pixels (should always be 8)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line">       <span class="mxinfo " id="T2:U95"><span class="var type1" id="S23T2U127">num_surrounding</span> = <span class="mxinfo " id="T2:U97">length(<span class="var type1" id="S21T28U130">rows</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line">       <span class="keyword">for</span> <span class="var type1" id="S24T2U133">p</span> = <span class="mxinfo " id="T2:U100">1</span> : <span class="var type1" id="S23T2U136">num_surrounding</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line">           <span class="keyword">if</span> <span class="mxinfo " id="T3:U102"><span class="mxinfo " id="T2:U103"><span class="var type1" id="S21T28U144">rows</span>(<span class="var type1" id="S24T2U145">p</span>)</span> &gt;= <span class="mxinfo " id="T2:U106">1</span></span> &amp;&amp; <span class="mxinfo " id="T3:U107"><span class="mxinfo " id="T2:U108"><span class="var type1" id="S22T28U149">cols</span>(<span class="var type1" id="S24T2U150">p</span>)</span> &gt;= <span class="mxinfo " id="T2:U111">1</span></span> &amp;&amp; <span class="mxinfo " id="T3:U112"><span class="mxinfo " id="T2:U113"><span class="var type1" id="S21T28U154">rows</span>(<span class="var type1" id="S24T2U155">p</span>)</span> &lt;= <span class="var type1" id="S10T2U156">height</span></span> &amp;&amp; <span class="mxinfo " id="T3:U117"><span class="mxinfo " id="T2:U118"><span class="var type1" id="S22T28U159">cols</span>(<span class="var type1" id="S24T2U160">p</span>)</span> &lt;= <span class="var type1" id="S11T2U161">width</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line">               <span class="comment">% Grab the current flag</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line">               <span class="mxinfo " id="T9:U122"><span class="var type1" id="S25T9U164">current_flag</span> = <span class="mxinfo " id="T9:U124"><span class="var type1" id="S2T1U166">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U126"><span class="var type1" id="S21T28U168">rows</span>(<span class="var type1" id="S24T2U169">p</span>)</span>, <span class="mxinfo " id="T2:U129"><span class="var type1" id="S22T28U171">cols</span>(<span class="var type1" id="S24T2U172">p</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line">               <span class="comment">% Measure the charge of the current flag</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line">               <span class="mxinfo " id="T2:U132"><span class="var type1" id="S26T2U175">current_flag_charge</span> = <span class="mxinfo " id="T2:U134"><span class="fcn" id="F81N4:B177">get_flags_charge</span>(<span class="var type1" id="S25T9U178">current_flag</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line">               <span class="comment">% If the charge of the current flag opposes the anchor flag</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line">               <span class="comment">% then place a branch cut and remove the two residues.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line">               <span class="mxinfo " id="T2:U136"><span class="var type1" id="S27T2U181">net_charge</span> = <span class="mxinfo " id="T2:U138"><span class="var type1" id="S19T2U183">anchor_charge</span> + <span class="var type1" id="S26T2U184">current_flag_charge</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line">               <span class="keyword">if</span> <span class="mxinfo " id="T3:U141"><span class="var type1" id="S27T2U188">net_charge</span> == <span class="mxinfo " id="T2:U143">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line">                   <span class="comment">% Set the anchor pixel charge to zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line">                   <span class="keyword">if</span> <span class="mxinfo " id="T3:U144"><span class="var type1" id="S19T2U193">anchor_charge</span> &gt; <span class="mxinfo " id="T2:U146">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line">                       <span class="mxinfo " id="T9:U147"><span class="mxinfo " id="T9:U148"><span class="var type1" id="S2T1U198">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U199">anchor_row</span>, <span class="var type1" id="S16T2U200">anchor_col</span>)</span> = <span class="mxinfo " id="T9:U152">bitset(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="mxinfo " id="T9:U147"><span class="mxinfo " id="T9:U152">                       <span class="mxinfo " id="T9:U153"><span class="var type1" id="S2T1U204">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U205">anchor_row</span>, <span class="var type1" id="S16T2U206">anchor_col</span>)</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="mxinfo " id="T9:U147"><span class="mxinfo " id="T9:U152">                       <span class="var type1" id="S3T2U207">positive_residue_bit_position</span>, 0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line">                   <span class="keyword">elseif</span> <span class="mxinfo " id="T3:U158"><span class="var type1" id="S19T2U211">anchor_charge</span> &lt; <span class="mxinfo " id="T2:U160">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line">                       <span class="mxinfo " id="T9:U161"><span class="mxinfo " id="T9:U162"><span class="var type1" id="S2T1U216">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U217">anchor_row</span>, <span class="var type1" id="S16T2U218">anchor_col</span>)</span> = <span class="mxinfo " id="T9:U166">bitset(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="mxinfo " id="T9:U161"><span class="mxinfo " id="T9:U166">                       <span class="mxinfo " id="T9:U167"><span class="var type1" id="S2T1U222">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U223">anchor_row</span>, <span class="var type1" id="S16T2U224">anchor_col</span>)</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="mxinfo " id="T9:U161"><span class="mxinfo " id="T9:U166">                       <span class="var type1" id="S4T2U225">negative_residue_bit_position</span>, 0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line">                   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line">                   <span class="comment">% Set the current pixel charge to zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line">                   <span class="keyword">if</span> <span class="mxinfo " id="T3:U172"><span class="var type1" id="S26T2U230">current_flag_charge</span> &gt; <span class="mxinfo " id="T2:U174">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line">                       <span class="mxinfo " id="T9:U175"><span class="mxinfo " id="T9:U176"><span class="var type1" id="S2T1U235">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U178"><span class="var type1" id="S21T28U237">rows</span>(<span class="var type1" id="S24T2U238">p</span>)</span>, <span class="mxinfo " id="T2:U181"><span class="var type1" id="S22T28U240">cols</span>(<span class="var type1" id="S24T2U241">p</span>)</span>)</span> = <span class="mxinfo " id="T9:U184">bitset(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="mxinfo " id="T9:U175"><span class="mxinfo " id="T9:U184">                       <span class="mxinfo " id="T9:U185"><span class="var type1" id="S2T1U245">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U187"><span class="var type1" id="S21T28U247">rows</span>(<span class="var type1" id="S24T2U248">p</span>)</span>, <span class="mxinfo " id="T2:U190"><span class="var type1" id="S22T28U250">cols</span>(<span class="var type1" id="S24T2U251">p</span>)</span>)</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="mxinfo " id="T9:U175"><span class="mxinfo " id="T9:U184">                       <span class="var type1" id="S3T2U252">positive_residue_bit_position</span>, 0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line">                   <span class="keyword">elseif</span> <span class="mxinfo " id="T3:U194"><span class="var type1" id="S26T2U256">current_flag_charge</span> &lt; <span class="mxinfo " id="T2:U196">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line">                       <span class="mxinfo " id="T9:U197"><span class="mxinfo " id="T9:U198"><span class="var type1" id="S2T1U261">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U200"><span class="var type1" id="S21T28U263">rows</span>(<span class="var type1" id="S24T2U264">p</span>)</span>, <span class="mxinfo " id="T2:U203"><span class="var type1" id="S22T28U266">cols</span>(<span class="var type1" id="S24T2U267">p</span>)</span>)</span> = <span class="mxinfo " id="T9:U206">bitset(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="mxinfo " id="T9:U197"><span class="mxinfo " id="T9:U206">                       <span class="mxinfo " id="T9:U207"><span class="var type1" id="S2T1U271">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U209"><span class="var type1" id="S21T28U273">rows</span>(<span class="var type1" id="S24T2U274">p</span>)</span>, <span class="mxinfo " id="T2:U212"><span class="var type1" id="S22T28U276">cols</span>(<span class="var type1" id="S24T2U277">p</span>)</span>)</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="mxinfo " id="T9:U197"><span class="mxinfo " id="T9:U206">                       <span class="var type1" id="S4T2U278">negative_residue_bit_position</span>, 0)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line">                   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line">                    <span class="comment">% Place the anchor pixel on a branch cut.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line">                   <span class="mxinfo " id="T9:U216"><span class="mxinfo " id="T9:U217"><span class="var type1" id="S2T1U283">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U284">anchor_row</span>, <span class="var type1" id="S16T2U285">anchor_col</span>)</span> = <span class="mxinfo " id="T9:U221">bitset(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="mxinfo " id="T9:U216"><span class="mxinfo " id="T9:U221">                       <span class="mxinfo " id="T9:U222"><span class="var type1" id="S2T1U289">FLAGS_MATRIX</span>(<span class="var type1" id="S14T2U290">anchor_row</span>, <span class="var type1" id="S16T2U291">anchor_col</span>)</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="mxinfo " id="T9:U216"><span class="mxinfo " id="T9:U221">                       <span class="var type1" id="S5T2U292">branch_cut_bit_position</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line">                   <span class="comment">% Place the box pixel on a branch cut.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line">                   <span class="mxinfo " id="T9:U227"><span class="mxinfo " id="T9:U228"><span class="var type1" id="S2T1U297">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U230"><span class="var type1" id="S21T28U299">rows</span>(<span class="var type1" id="S24T2U300">p</span>)</span>, <span class="mxinfo " id="T2:U233"><span class="var type1" id="S22T28U302">cols</span>(<span class="var type1" id="S24T2U303">p</span>)</span>)</span> = <span class="mxinfo " id="T9:U236">bitset(<span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="mxinfo " id="T9:U227"><span class="mxinfo " id="T9:U236">                       <span class="mxinfo " id="T9:U237"><span class="var type1" id="S2T1U307">FLAGS_MATRIX</span>(<span class="mxinfo " id="T2:U239"><span class="var type1" id="S21T28U309">rows</span>(<span class="var type1" id="S24T2U310">p</span>)</span>, <span class="mxinfo " id="T2:U242"><span class="var type1" id="S22T28U312">cols</span>(<span class="var type1" id="S24T2U313">p</span>)</span>)</span>, <span class="keyword">...</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="mxinfo " id="T9:U227"><span class="mxinfo " id="T9:U236">                       <span class="var type1" id="S5T2U314">branch_cut_bit_position</span>, 1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line">                   <span class="comment">% Break the for-loop</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line">                   <span class="keyword">break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line">               <span class="keyword">end</span> <span class="comment">% End if net_charge == 0</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line">           <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line">           </span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line">       <span class="keyword">end</span> <span class="comment">% End looping around surrounding pixels</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line">   <span class="keyword">end</span> <span class="comment">% end if(is_residue)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line">       </span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="keyword">end</span> <span class="comment">% End looping over all detected residues.</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"></span></span>
</pre>
